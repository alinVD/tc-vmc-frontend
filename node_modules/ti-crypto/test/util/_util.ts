/**
 * Testing utilities.
 * 
 * @author Sam Claus
 * @version 10/20/17
 * @copyright Tera Insights, LLC.
 */

import {
    AESKey,
    base64ToBytes,
    randomBytes
} from "../../src";
import {expect} from "chai";

export function testEncryptDecrypt(encryptor: AESKey, decryptor: AESKey): Promise<any> {
    let data = randomBytes(Math.floor(Math.random() * 30));
    let copy = data.slice(); // encrypt scrubs our clear data from memory--we need original for comparison
    return encryptor.encrypt(data).then(result => {
        return decryptor.decrypt(
            base64ToBytes(result.cipherText),
            result.algo,
            base64ToBytes(result.iv)
        ).then(decrypted => {
            expect(decrypted).to.deep.equal(copy)
        });
    });
}